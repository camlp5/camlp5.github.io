

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Locations &mdash; Camlp5  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Syntax tree" href="ml_ast.html" />
    <link rel="prev" title="Language extensions" href="language-extensions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Camlp5
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="strict.html">Transitional and Strict modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="ptools.html">Parsing and Printing tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="parsing-tools.html">Printing tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="printing-tools.html">Parsing tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="language-extensions.html">Language extensions</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Locations</a></li>
<li class="toctree-l2"><a class="reference internal" href="ml_ast.html">Syntax tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="ast_transi.html">Syntax tree - transitional mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="ast_strict.html">Syntax tree - strict mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="q_ast.html">Syntax tree quotations in user syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="pcaml.html">The Pcaml module</a></li>
<li class="toctree-l2"><a class="reference internal" href="directives.html">Directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="syntext.html">Extensions of syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="opretty.html">Extensions of printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="redef.html">Redefining OCaml syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="quot.html">Quotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="revsynt.html">The revised syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme.html">Scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme.html#ocaml-scheme">OCaml                                     Scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme.html#ocaml-lisp">OCaml                                     Lisp</a></li>
<li class="toctree-l2"><a class="reference internal" href="macros.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="pragma.html">Pragma directive</a></li>
<li class="toctree-l2"><a class="reference internal" href="extfun.html">Extensible functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conclusion.html">Future work</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Camlp5</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="language-extensions.html">Language extensions</a> &raquo;</li>
        
      <li>Locations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/camlp5/camlp5/blob/master/doc/rstlocations.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="locations">
<h1>Locations<a class="headerlink" href="#locations" title="Permalink to this headline">¶</a></h1>
<div class="docutils container" id="content">
<p class="top rubric" id="id1">Locations</p>
<p>The location is a concept often used in Camlp5, bound to where errors
occur in the source. The basic type is “<code class="docutils literal"><span class="pre">Ploc.t</span></code>” which is an
abstract type.</p>
<p class="rubric" id="definitions">Definitions</p>
<p>Internally a location is a pair of source <em>positions</em>: the beginning
and the end of an element in the source (file or interactive). A
located element can be a character (the end is just the beginning
plus one), a token, or a longer sequence generally corresponding to a
grammar rule.</p>
<p>A <em>position</em> is a count of characters since the beginning of the
file, starting at zero. When a couple of positions define a location,
the first position is the position of the first character of the
element, and the last position is the first character <em>not</em> part of
the element. The location length is the difference between those two
numbers. Notice that the position corresponds exactly to the
character count in the streams of characters.</p>
<p>In the <a class="reference external" href="grammars.html">extensible grammars</a>, a variable with the
specific name “<code class="docutils literal"><span class="pre">loc</span></code>” is predefined in all semantic actions: it is
the location of the associated rule. Since the <a class="reference external" href="ml_ast.html">syntax tree
quotations</a> generate nodes with “<code class="docutils literal"><span class="pre">loc</span></code>” as location
part, this allow to generate grammars without having to consider
source locations.</p>
<p>It is possible to change the name “<code class="docutils literal"><span class="pre">loc</span></code>” to another name, through
the parameter “<code class="docutils literal"><span class="pre">-loc</span></code>” of the Camlp5 commands.</p>
<p>Remark: the reason why the type “<code class="docutils literal"><span class="pre">location</span></code>” is abstract is that in
future versions, it may contain other informations, such as the
associated comments, the type (for expressions nodes), things like
that, without having to change the already written programs.</p>
<p class="rubric" id="building-locations">Building locations</p>
<p>Tools are provided in the module “<code class="docutils literal"><span class="pre">Ploc</span></code>” to manage locations.</p>
<p>First, “<code class="docutils literal"><span class="pre">Ploc.dummy</span></code>” is a dummy location used when the element
does not correspond to any source, or if the programmer does not want
to worry about locations.</p>
<p>The function “<code class="docutils literal"><span class="pre">Ploc.make</span></code>” builds a location from three parameters:</p>
<ul class="simple">
<li>the line number, starting at 1</li>
<li>the position of the first column of the line</li>
<li>a couple of positions of the location: the first one belonging to
the given line, the second one being able to belong to another
line, further.</li>
</ul>
<p>If the line number is not known, it is possible to use the function
“<code class="docutils literal"><span class="pre">Ploc.make_unlined</span></code>” taking only the couple of positions of the
location. In this case, error messages may indicate the first line
and a big count of characters from this line (actually from the
beginning of the file). With a good text editor, it is possible, to
find the good location, anyway.</p>
<p>If the location is built with “<code class="docutils literal"><span class="pre">Ploc.make_unlined</span></code>”, and if your
program displays a source location itself, it is possible to use the
function “<code class="docutils literal"><span class="pre">Ploc.from_file</span></code>” which takes the file name and the
location as parameters and return, by reading that file, the line
number, and the character positions of the location.</p>
<p class="rubric" id="raising-with-a-location">Raising with a location</p>
<p>The function “<code class="docutils literal"><span class="pre">Ploc.raise</span></code>” allows one to raise an exception
together with a location. All exceptions raised in the <a class="reference external" href="grammars.html">extensible
grammars</a> use “<code class="docutils literal"><span class="pre">Ploc.raise</span></code>”. The raised
exception is “<code class="docutils literal"><span class="pre">Ploc.Exc</span></code>” with two parameters: the location and the
exception itself.</p>
<p>Notice that “<code class="docutils literal"><span class="pre">Ploc.raise</span></code>” just reraises the exception if it is
already the exception “<code class="docutils literal"><span class="pre">Ploc.Exc</span></code>”, ignoring then the new given
location.</p>
<p>A paradigm to print exceptions possibly enclosed by “<code class="docutils literal"><span class="pre">Ploc.Exc</span></code>” is
to write the “<code class="docutils literal"><span class="pre">try..with</span></code>” statement like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="o">...</span> <span class="k">with</span> <span class="n">exn</span> <span class="o">-&gt;</span>
  <span class="n">let</span> <span class="n">exn</span> <span class="o">=</span>
    <span class="n">match</span> <span class="n">exn</span> <span class="k">with</span>
    <span class="p">[</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">Exc</span> <span class="n">loc</span> <span class="n">exn</span> <span class="o">-&gt;</span> <span class="n">do</span> <span class="p">{</span> <span class="o">...</span> <span class="nb">print</span> <span class="n">the</span> <span class="n">location</span> <span class="o">...</span><span class="p">;</span> <span class="n">exn</span> <span class="p">}</span>
    <span class="o">|</span> <span class="n">_</span> <span class="o">-&gt;</span> <span class="n">exn</span> <span class="p">]</span>
  <span class="ow">in</span>
  <span class="n">match</span> <span class="n">exn</span> <span class="k">with</span>
  <span class="o">...</span><span class="n">print</span> <span class="n">the</span> <span class="n">exception</span> <span class="n">which</span> <span class="ow">is</span> <span class="o">*</span><span class="ow">not</span><span class="o">*</span> <span class="n">located</span><span class="o">...</span>
</pre></div>
</div>
<p class="rubric" id="other-functions">Other functions</p>
<p>Some other functions are provided:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">Ploc.first_pos</span></code></dt>
<dd>returns the first position (an integer) of the location.</dd>
<dt><code class="docutils literal"><span class="pre">Ploc.last_pos</span></code></dt>
<dd>returns the last position (an integer) of the location (position
of the first character not belonging to the element.</dd>
<dt><code class="docutils literal"><span class="pre">Ploc.line_nb</span></code></dt>
<dd>returns the line number of the location or <code class="docutils literal"><span class="pre">-1</span></code> if the location
does not contain a line number (i.e. built by
“<code class="docutils literal"><span class="pre">Ploc.make_unlined</span></code>”).</dd>
<dt><code class="docutils literal"><span class="pre">Ploc.bol_pos</span></code></dt>
<dd>returns the position of the beginning of the line of the location.
It is zero if the location does not contain a line number (i.e.
built by “<code class="docutils literal"><span class="pre">Ploc.make_unlined</span></code>”).</dd>
</dl>
<p>And still other ones used in Camlp5 sources:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">Ploc.encl</span></code></dt>
<dd>“<code class="docutils literal"><span class="pre">Ploc.encl</span> <span class="pre">loc1</span> <span class="pre">loc2</span></code>” returns the location starting at the
smallest begin of “<code class="docutils literal"><span class="pre">loc1</span></code>” and “<code class="docutils literal"><span class="pre">loc2</span></code>” and ending at their
greatest end.. In simple words, it is the location enclosing
“<code class="docutils literal"><span class="pre">loc1</span></code>” and “<code class="docutils literal"><span class="pre">loc2</span></code>” and all what is between them.</dd>
<dt><code class="docutils literal"><span class="pre">Ploc.shift</span></code></dt>
<dd>“<code class="docutils literal"><span class="pre">Ploc.shift</span> <span class="pre">sh</span> <span class="pre">loc</span></code>” returns the location “<code class="docutils literal"><span class="pre">loc</span></code>” shifted
with “<code class="docutils literal"><span class="pre">sh</span></code>” characters. The line number is not recomputed.</dd>
<dt><code class="docutils literal"><span class="pre">Ploc.sub</span></code></dt>
<dd>“<code class="docutils literal"><span class="pre">Ploc.sub</span> <span class="pre">loc</span> <span class="pre">sh</span> <span class="pre">len</span></code>” is the location “<code class="docutils literal"><span class="pre">loc</span></code>” shifted with
“<code class="docutils literal"><span class="pre">sh</span></code>” characters and with length “<code class="docutils literal"><span class="pre">len</span></code>”. The previous ending
position of the location is lost.</dd>
<dt>“<code class="docutils literal"><span class="pre">Ploc.after</span></code>”</dt>
<dd>“<code class="docutils literal"><span class="pre">Ploc.after</span> <span class="pre">loc</span> <span class="pre">sh</span> <span class="pre">len</span></code>” is the location just after “<code class="docutils literal"><span class="pre">loc</span></code>”
(i.e. starting at the end position of “<code class="docutils literal"><span class="pre">loc</span></code>”), shifted with
“<code class="docutils literal"><span class="pre">sh</span></code>” characters, and of length “<code class="docutils literal"><span class="pre">len</span></code>”.</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ml_ast.html" class="btn btn-neutral float-right" title="Syntax tree" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="language-extensions.html" class="btn btn-neutral float-left" title="Language extensions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2007-2017, INRIA (Institut National de Recherches en Informatique et Automatique). All rights reserved.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>